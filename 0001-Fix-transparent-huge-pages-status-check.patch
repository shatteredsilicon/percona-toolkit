From a1d1fca2feb643885464fc416e0003fe44378137 Mon Sep 17 00:00:00 2001
From: Jason Ng <oblitorum@gmail.com>
Date: Tue, 6 Aug 2024 03:42:25 +0800
Subject: [PATCH] Fix transparent huge pages status check

---
 bin/pt-summary                 | 1 +
 lib/bash/report_system_info.sh | 1 +
 2 files changed, 2 insertions(+)

diff --git a/bin/pt-summary b/bin/pt-summary
index f2e203c9..d46e748d 100755
--- a/bin/pt-summary
+++ b/bin/pt-summary
@@ -2317,6 +2317,7 @@ report_system_summary () { local PTFUNCNAME=report_system_summary;
 
 report_transparent_huge_pages () {
 
+  STATUS_THP_SYSTEM=0
   if [ -f /sys/kernel/mm/transparent_hugepage/enabled ]; then
     CONTENT_TRANSHP=$(</sys/kernel/mm/transparent_hugepage/enabled)
     STATUS_THP_SYSTEM=$(echo $CONTENT_TRANSHP | grep -cv '\[never\]')
diff --git a/lib/bash/report_system_info.sh b/lib/bash/report_system_info.sh
index aa19d2b0..59ecf766 100644
--- a/lib/bash/report_system_info.sh
+++ b/lib/bash/report_system_info.sh
@@ -1122,6 +1122,7 @@ report_system_summary () { local PTFUNCNAME=report_system_summary;
 
 report_transparent_huge_pages () {
 
+  STATUS_THP_SYSTEM=0
   if [ -f /sys/kernel/mm/transparent_hugepage/enabled ]; then
     CONTENT_TRANSHP=$(</sys/kernel/mm/transparent_hugepage/enabled)
     STATUS_THP_SYSTEM=$(echo $CONTENT_TRANSHP | grep -cv '\[never\]')
-- 
2.44.2

